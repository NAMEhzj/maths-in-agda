--library=maths

open import Algebra.Group.Group
open import Base.Sets
open import Base.Equivalence hiding (_âˆ˜_)
open import Agda.Primitive
open import Base.PropTruncation
open import Data.Unit

module Algebra.Group.Subgroup {l} (G : Set l) (G' : Group G) where  

open Group G'

record Subgroup {b} (U : ğ’« G {b}) : Set (l âŠ” b) where
                field
                  eâˆˆU : e âˆˆ U
                  âˆ˜-closed : (x y : G) â†’ x âˆˆ U â†’ y âˆˆ U â†’ x âˆ˜ y âˆˆ U 
                  inv-closed : (x : G) â†’ x âˆˆ U â†’ x â»Â¹ âˆˆ U



record closedProp {m} (P : (x : G) â†’ Set m) : Set (l âŠ” m) where
                 field
                  Pe : P e
                  âˆ˜-closed : (x y : G) â†’ P x â†’ P y â†’ P (x âˆ˜ y)
                  inv-closed : (x : G) â†’ P x â†’ P (x â»Â¹)


open Subgroup

propSubgroup : âˆ€{m} (P : (a : G) â†’ Set m) â†’ closedProp P â†’ Subgroup (propSubset P)
eâˆˆU (propSubgroup P closed) = (e , âˆ£ closedProp.Pe closed âˆ£) , refl
âˆ˜-closed (propSubgroup P closed) x y ((.x , âˆ£Pxâˆ£) , refl)  ((.y , âˆ£Pyâˆ£) , refl) = ((x âˆ˜ y , liftToTrunc2* prf âˆ£Pxâˆ£ âˆ£Pyâˆ£) , refl)
                                                               where prf : P x â†’ P y â†’ âˆ¥ P (x âˆ˜ y) âˆ¥
                                                                     prf Px Py = âˆ£ closedProp.âˆ˜-closed closed x y Px Py âˆ£ 
inv-closed (propSubgroup P closed) x ((.x , âˆ£Pxâˆ£) , refl) = ((x â»Â¹ , liftToTrunc* prf âˆ£Pxâˆ£) , refl)
                                                               where prf : P x â†’ âˆ¥ P (x â»Â¹) âˆ¥
                                                                     prf Px = âˆ£ closedProp.inv-closed closed x Px âˆ£


open Base.Sets.ğ’«

neutSubset : ğ’« G
U neutSubset = âŠ¤
i neutSubset tt = e
injective neutSubset tt tt _ = refl

open import Algebra.Group.GroupProps1 G G'

neutSubgroup : Subgroup neutSubset
eâˆˆU neutSubgroup = tt , refl
âˆ˜-closed neutSubgroup a b (tt , refl)  (tt , refl) = tt , =sym (Group.LNeut G' e) 
inv-closed neutSubgroup a (tt , refl) = tt , =sym neutInv


wholeGroup : Subgroup (wholeSet G)
eâˆˆU wholeGroup = e , refl 
âˆ˜-closed wholeGroup a b _ _ = a âˆ˜ b , refl
inv-closed wholeGroup a _ = a â»Â¹ , refl

